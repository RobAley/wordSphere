<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Graph</title>
    <style>
      svg {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
      }
      .node circle {
        stroke: #252525;
        stroke-width: 1.5px;
      }
      .link {
          stroke: #000;
      }
    </style>
  </head>
  <body>
    <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
    <script>
      $(function() {
          "use strict";

          var force = d3.layout.force()
              .charge(-120)
              .linkDistance(100)
              .size([$(window).innerWidth(), $(window).innerHeight()]);
          $(window).on('resize', function() {
              force.size([$('svg').width(), $('svg').height()]);
          });
          var scrollX = 0;
          var scrollY = 0;
          var svg = d3.select("body").append("svg");
          d3.json("test.json", function(error, graph) {
              force
                  .nodes(graph.nodes)
                  .links(graph.links)
                  .start();
              var link = svg.selectAll(".link")
                  .data(graph.links)
                  .enter().append("line")
                  .attr("class", "link")
                  .style("stroke-width", 1);
              var node = svg.selectAll(".node")
                  .data(graph.nodes)
                  .enter().append("g")
                  .attr("id", function(d) { return d.name; })
                  .attr("class", "node")
                  .attr("transform", function(d) { return "translate(" + d.x + ", " + d.y + ")"; })
                  .call(force.drag);

              node.append("circle")
                  .attr("r", 5)
                  .style("fill", "gray");

              node.append("text")
                  .text(function(d) { return d.name; });

              force.on("tick", function() {
                  link.attr("x1", function(d) { return scrollX + d.source.x; })
                      .attr("y1", function(d) { return scrollY + d.source.y; })
                      .attr("x2", function(d) { return scrollX + d.target.x; })
                      .attr("y2", function(d) { return scrollY + d.target.y; });

                  node.attr("transform", function(d) { return "translate(" + (scrollX + d.x) + ", " + (scrollY + d.y) + ")"; });
              });
              var grab = null;
              $("svg").on("mousedown", function(e) {
                  if (e.which === 1) {
                      grab = {
                          pageX: e.pageX,
                          pageY: e.pageY,
                          scrollX: scrollX,
                          scrollY: scrollY
                      };
                  }
              });
              $("svg").on("mousemove", function(e) {
                  if (e.which === 1 && grab) {
                      scrollX = grab.scrollX + (e.pageX - grab.pageX);
                      scrollY = grab.scrollY + (e.pageY - grab.pageY);
                      link.attr("x1", function(d) { return scrollX + d.source.x; })
                          .attr("y1", function(d) { return scrollY + d.source.y; })
                          .attr("x2", function(d) { return scrollX + d.target.x; })
                          .attr("y2", function(d) { return scrollY + d.target.y; });

                      node.attr("transform", function(d) { return "translate(" + (scrollX + d.x) + ", " + (scrollY + d.y) + ")"; });
                  }
              });
              $("svg").on("mouseup", function(e) {
                  if (e.which === 1) {
                      grab = null;
                  }
              });
          });
      });
    </script>
  </body>
</html>
